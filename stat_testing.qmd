---
title: "statistic_testing"
format: html
editor: visual
---

```{r}
library(tidyverse)
library(stargazer)
library(pheatmap)
```

```{r}

df_award <- read.csv('data/wrd_04_all-data.csv')
df_wipo <- read.csv('data/wipo_design.csv')

summary(df_wipo)
```

```{r}
df_wipo %>%
  mutate(
    wipo_period = paste(wipo_year_from, wipo_year_to, sep = " - ")
  ) %>%
  group_by(wipo_period) %>%
  summarise(frecuencia = n(), .groups = "drop") %>%
  ggplot(aes(x = wipo_period, y = frecuencia)) +
  geom_col(fill = 'steelblue') +
  labs(title = "Número de registros por año", x = "Año", y = "Frecuencia") +
  guides(x =  guide_axis(angle = 90)) +
  theme_minimal()
```

```{r}
df_nuevo <- df_award %>%
  mutate(
    award_fyear = as.numeric(str_extract(award_period, '\\d{4}$'))
  ) %>%
  filter(award_fyear > 2014 & award_fyear < 2023)

length(unique(df_nuevo$designer_country))
```

```{r}

length(unique(df_wipo$country_code, na.rm = T))
```

```{r}

ECIs <- read.csv('test/All_ECIs.csv') %>%
  select(-c(X.1, X)) %>%
  mutate(
    asia = as.factor(asia),
    latam = as.factor(latam),
    africa = as.factor(africa)
  )
ECIs
```

```{r}
ajuste_1 <- lm(
  log_PIB ~ dci_award+ asia + latam + africa, data = ECIs
)
ajuste_2 <- lm(
  log_PIB ~ dci_wipo+ asia + latam + africa, data = ECIs
)
ajuste_interaccion <- lm(
  log_PIB ~ dci_award + dci_wipo + dci_award * dci_wipo + asia + latam + africa,
  data = ECIs
)
ajuste_3 <- lm(
  log_PIB ~ ECI_tr+ asia + latam + africa, data = ECIs
)
ajuste_4 <- lm(
  log_PIB ~ ECI_te+ asia + latam + africa, data = ECIs
)
ajuste_5 <- lm(
  log_PIB ~ ECI_rs+ asia + latam + africa, data = ECIs
)
ajuste_6 <- lm(
  log_PIB ~ dci_award+ asia + latam + africa, data = ECIs
)
ajuste_7 <- lm(
  log_PIB ~ dci_award+ asia + latam + africa, data = ECIs
)
ajuste_semitotal <- lm(
  log_PIB ~ dci_award + dci_wipo + ECI_tr + ECI_te + ECI_rs+ asia + latam + africa, data = ECIs
)
ajuste_total <- lm(
  log_PIB ~ dci_award + dci_wipo + dci_award * dci_wipo + ECI_tr + ECI_te + ECI_rs+ asia + latam + africa, data = ECIs
)

stargazer(ajuste_1, ajuste_2, ajuste_3, ajuste_4, ajuste_5, ajuste_total, type = 'text' )
#+ asia + latam + africa
```

```{r}
corruwu <- cor(ECIs[, c('dci_award', 'dci_wipo', 'ECI_tr', 'ECI_te', 'ECI_rs')]) - diag(5)
```

```{r}

pheatmap(corruwu, 
         color = colorRampPalette(c("white", "red2"))(20),
         breaks = seq(0, 1, length.out = 20),
         main = "Matriz de Correlación",
         angle_col = 45)
```

```{r}



```
